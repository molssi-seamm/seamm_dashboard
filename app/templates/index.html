<!--
* CoreUI - Free Bootstrap Admin Template
* @version v2.0.0-beta.0
* @link https://coreui.io
* Copyright (c) 2018 creativeLabs Łukasz Holeczek
* Licensed under MIT (https://coreui.io/license)
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <link rel="shortcut icon" href="{{  url_for('static', filename='images/molssi-favicon.jpg') }}">
    <title>SEAMM Dashboard</title>

    <!-- Main styles for this application-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='node_modules/datatables.net-select-dt/css/select.dataTables.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='node_modules/datatables.net-bs4/css/dataTables.bootstrap4.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='node_modules/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css') }}"/>
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/prism.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/timer.js') }}"></script>
  </head>

  <body class="app header-fixed sidebar-fixed aside-menu-fixed sidebar-lg-show">
    <header class="app-header navbar">
      <button class="navbar-toggler sidebar-toggler d-lg-none mr-auto" type="button" data-toggle="sidebar-show">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#">
        <img class="navbar-brand-full" src="{{ url_for('static', filename='images/MolSSI-Logo-xl.jpg') }}"  height="50" alt="MolSSI">
        <img class="navbar-brand-minimized" src="{{ url_for('static', filename='images/molssi-favicon.jpg') }}" width="30" height="30" alt="CoreUI Logo">
      </a>
      <button class="navbar-toggler sidebar-toggler d-md-down-none" type="button" data-toggle="sidebar-lg-show">
        <span class="navbar-toggler-icon"></span>
      </button>
      <ul class="nav navbar-nav d-md-down-none">
        <li class="nav-item px-3">
          <a class="nav-link" href="#">Dashboard</a>
        </li>
        <li class="nav-item px-3">
          <a class="nav-link" href="#">Users</a>
        </li>
        <li class="nav-item px-3">
          <a class="nav-link" href="#">Settings</a>
        </li>
      </ul>
      <ul class="nav navbar-nav ml-auto">
          <div class="dropdown-menu dropdown-menu-right">
          </div>
        </li>
      </ul>
    </header>
    <div class="app-body">
      <div class="sidebar">
        <nav class="sidebar-nav">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" href="main.html">
                <i class="nav-icon fas fa-tachometer-alt"></i> Dashboard
              </a>
            </li>
              <li class="nav-item">
              <a class="nav-link" href="jobs">
                <i class="nav-icon fas fa-list"></i> Jobs List</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="flowcharts">
                <i class="nav-icon fas fa-project-diagram"></i> Flowcharts List</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="projects">
                <i class="nav-icon fas fa-object-group"></i> Projects List</a>
            </li>
            <li class="nav-title">Actions</li>
              <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="nav-icon fas fa-puzzle-piece"></i> Submit Job</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="nav-icon fas fa-cloud-upload-alt"></i> Import Job</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="nav-icon fas fa-download"></i> Export DB</a>
            </li>
            <li class="nav-title">Server</li>
            <li class="nav-item nav-dropdown">
              <a class="nav-link nav-dropdown-toggle" href="#">
                <i class="nav-icon fas fa-cogs"></i> Settings</a>
              <ul class="nav-dropdown-items">
                <li class="nav-item">
                  <a class="nav-link" href="#">
                    <i class="nav-icon far fa-edit"></i> Edit</a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
        <button class="sidebar-minimizer brand-minimizer" type="button"></button>
      </div>
      <main class="main">
        <ol class="breadcrumb">
          <!-- Breadcrumb Menu-->
          <li class="breadcrumb-menu d-md-down">
            <div class="btn-group" role="group" aria-label="Button group">
              <a class="btn" id="login-info-1"></a>
              <a class="btn" id="login-info-2"></a>
            </div>
            <a class="btn" id="login-info-3"></a>
          </li>
        </ol>
        <div class="container-fluid vh-100 mt-3">
          <div id="ui-view"></div>
        </div>
      </main>
    </div>
    <footer class="app-footer">
      <div>
        <a href="http://molssi.org">MolSSI</a>
        <span>&copy; 2018-2020 The Molecular Sciences Software Institute.</span>
      </div>
    </footer>
    <!-- Bootstrap and necessary plugins-->
    <script src="{{ url_for('static', filename='node_modules/jquery/dist/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/jquery-csv/src/jquery.csv.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/popper.js/dist/umd/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/bootstrap/dist/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/pace-progress/pace.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/perfect-scrollbar/dist/perfect-scrollbar.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/@coreui/coreui/dist/js/coreui.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/cytoscape/dist/cytoscape.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/@fortawesome/fontawesome-free/js/all.min.js')}}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='node_modules/jstree/dist/themes/default/style.css') }}" />
    <script src="{{ url_for('static', filename='node_modules/jstree/dist/jstree.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/plotly.js-dist-min/plotly.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/ngl/dist/ngl.js') }}"></script>
    <script src="{{ url_for('static', filename='js/prism.js') }}"></script>
    
    <!-- extras -->
    <script src="{{ url_for('static', filename='node_modules/datatables.net/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/datatables.net-dt/js/dataTables.dataTables.min.js') }}"></script> 
    <script src="{{ url_for('static', filename='node_modules/datatables.net-bs4/js/dataTables.bootstrap4.min.js') }}"></script> 
    <script src="{{ url_for('static', filename='node_modules/datatables.net-select/js/dataTables.select.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/datatables.net-buttons/js/dataTables.buttons.min.js') }}"></script>


    <script>
      $('#ui-view').ajaxLoad();
      // Prevent caching on ajax calls.
      $.ajaxSetup ({
        cache: false
        });

        // Get username and stuff
        $.ajax({
        url: `api/status`,
        dataType: 'json',
        async: false,
        success: function (data) {
            //console.log(data)
            if (data.username == "Anonymous User") {
              document.getElementById("login-info-1").innerHTML = `Not Logged In`
              document.getElementById("login-info-2").innerHTML = '<a href="auth/login">Log In</a>'
            }

            else {
              document.getElementById("login-info-1").innerHTML = `Logged in as ${data.username}`
              document.getElementById("login-info-2").innerHTML = '<a href="auth/logout">Log Out</a>'

              if (data.roles.includes("admin")) {
                document.getElementById("login-info-3").innerHTML = '<a href="auth/manage_users">Manage Users</a>'
              }
            }

            if (data.username != "Anonymous User") {
              idleTimer()
            }
           
            },
            // error occurs because of expired access token. Remove cookie and reload page
            error: function () {
              $.ajax({
                url: `auth/logout`,
                complete: location.reload()
              })
              
            },
          })

          window.addEventListener('storage', function(event){
            if (event.key == 'logout-event') { 
              $.ajax({
                url: `auth/logout`,
                complete: function() {
                  location.reload()
                }
              })
            }
          })

          window.addEventListener('storage', function(event){
            if (event.key == 'login-event') { 
              location.reload()
            }
          });
    </script>
  </body>
</html>